////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_trg_onenter.nss
//    $Revision:: 236        $ current version of the file
//        $Date:: 2007-01-21#$ date the file was created or modified
//       Author : Cipher
//
//    Var Prefix:
//  Dependencies:
//
//  Description
//  This script calls the ACR's OnEnter code for triggers, and any
//  custom code a server may need. It is not updated in ACR updates.
//
//  Revision History
//  2007/01/20  Cipher  Inception
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include "acr_trigger_i"
#include "acr_quest_i"



////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main()
{
    ACR_TriggerOnEnter();

    // Custom code goes here.
	


//Forthpeak Exterior quest script.
 if(GetTag(OBJECT_SELF) == "fp_scout_02_b") 
 	{int nQuestState = ACR_RetrieveQuestState("fp_scout_01", GetEnteringObject());
	 object oCorpse = GetObjectByTag("fp_scout_01_orccorpse");
	 if(nQuestState > 1 && nQuestState < 4)
	 	{SetUseableFlag(oCorpse, TRUE);
	 	 object oStone = GetFirstItemInInventory(oCorpse);
		 if(oStone == OBJECT_INVALID)
			 {CreateItemOnObject("abr_it_gem_083b", oCorpse, 1);
			 }
		 if((GetTag(oStone) != "abr_it_gem") && (oStone != OBJECT_INVALID))
		 	{oStone = GetNextItemInInventory(oCorpse);
			 if(oStone == OBJECT_INVALID)
				 {CreateItemOnObject("abr_it_gem_083b", oCorpse, 1);
				 }
			 if(GetTag(oStone) != "abr_it_gem")
			 	{CreateItemOnObject("abr_it_gem_083b", oCorpse, 1);
				}
			}
		 }
	}
	
	
	
//Frost Hills Glacier Ice Climb
if(GetTag(OBJECT_SELF) == "iceclimb_trig")
	{SendMessageToPC(GetEnteringObject(), "Slippery handholds offer treacherous purchase.");
		if(ReflexSave(GetEnteringObject(), 15, SAVING_THROW_TYPE_NONE, OBJECT_SELF) > 0)
			{SendMessageToPC(GetEnteringObject(), "You climb safely.");
			}
		else{SendMessageToPC(GetEnteringObject(), "You slip, injuring yourself!");
			effect eSlip = EffectDamage(d4(1), DAMAGE_TYPE_BLUDGEONING, DAMAGE_POWER_NORMAL, FALSE);
			effect eKnockdownIce = EffectKnockdown();
			ApplyEffectToObject(DURATION_TYPE_TEMPORARY, eKnockdownIce, GetEnteringObject(), 3.0);
			ApplyEffectToObject(DURATION_TYPE_INSTANT, eSlip, GetEnteringObject());
			}
	}
	
}