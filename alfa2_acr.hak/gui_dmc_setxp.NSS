////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR GUI Script
//     Filename : gui_dmc_setxp
//    $Revision:: 538        $ current version of the file
//        $Date:: 2008-04-23#$ date the file was created or modified
//       Author : Cipher
//
//    Var Prefix: ACR_GUI
//  Dependencies: None
//
//  Description
//  This script is called from the Set Experience radial option on the DM context menu.
//
//  Revision History
//  2008/04/08  Cipher  Inception
//  2008/04/23  Cipher  Passed DM object to event log, renamed oPC to oDM for clarity
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include "acr_xp_i"
#include "acr_1984_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
const string ACR_GUI_SCREEN_DM_SETXP = "SCREEN_DM_SETXP";
const string ACR_GUI_FILENAME_DM_SETXP = "dmsetxp.xml";

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main(int nXP)
{
    object oDM = OBJECT_SELF;
    object oTarget = GetPlayerCurrentTarget(oDM);
    string sGender;

    // only allow script execution by DMs
    if (!(GetIsDM(oDM) || GetIsDMPossessed(oDM))) { return; }

    // determine the correct gender pronoun
    switch (GetGender(oTarget))
    {
        case GENDER_MALE:   sGender = "his"; break;
        case GENDER_FEMALE: sGender = "her"; break;
        default:            sGender = "its"; break;
    }

    // if no XP has been provided, ask for input
    if (nXP < 0)
    {
        // display the xp input screen and xp total of the target player on the GUI
        DisplayGuiScreen(oDM, ACR_GUI_SCREEN_DM_SETXP, FALSE, ACR_GUI_FILENAME_DM_SETXP);
        SetGUIObjectText(oDM, ACR_GUI_SCREEN_DM_SETXP, "MESSAGETEXT", -1, GetName(oTarget) + " currently has " + IntToString(GetXP(oTarget)) + "xp.\n\nWhat would you like to set " + sGender + " experience total to?");
    }
    // otherwise, process the input
    else
    { 
        // close the GUI and set the target player's experience
        CloseGUIScreen(oDM, ACR_GUI_SCREEN_DM_SETXP);
        SetXP(oTarget, nXP); ACR_CorrectXPTotals(oTarget);
		SendMessageToPC(oDM, "You have set "+GetName(oTarget)+" to "+IntToString(nXP)+" XP.");
        // log the XP change
        ACR_LogEvent(oTarget, ACR_LOG_SETXP, "DM " + GetName(oDM) + " (" + ACR_GetPCPublicCDKey(oDM) + ") set experience to " + IntToString(nXP), oDM);
    }
}
