////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ALFA Core Rules
//     Filename : acr_queue_i.nss
//      Version : 0.1
//         Date : 2011-05-26
//       Author : Ronan
//
//  Local Variable Prefix = ACR_QUE
//
//
//  Dependencies external of nwscript: None
//
//  Description
//  A FIFO queue implementation in NWScript
//
//  Revision History
////////////////////////////////////////////////////////////////////////////////

#ifndef ACR_QUEUE_I
#define ACR_QUEUE_I

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

const string _ACR_QUEUE_HEAD_LI = "ACR_QUE_H|";
const string _ACR_QUEUE_TAIL_LI = "ACR_QUE_T|";

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

//! Pushes a string sVal onto queue sQueue on oOBject.
void PushQueueString(object oObject, string sQueue, string sVal);

//! Pops a string from sQueue on oObject, returning it.
string PopQueueString(object oObject, string sQueue);

//! Returns the length of the named queue.
int GetQueueLength(object oObject, string sQueue);

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

#include "acr_array_i"

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void PushQueueString(object oObject, string sQueue, string sVal) {
	int tail = GetLocalInt(oObject, _ACR_QUEUE_TAIL_LI + sQueue);

	SetLocalArrayString(oObject, sQueue, tail, sVal);
	SetLocalInt(oObject, _ACR_QUEUE_TAIL_LI + sQueue, tail + 1);
}

string PopQueueString(object oObject, string sQueue) {
	int tail = GetLocalInt(oObject, _ACR_QUEUE_TAIL_LI + sQueue);
	int head = GetLocalInt(oObject, _ACR_QUEUE_HEAD_LI + sQueue);

	if(head >= tail) return "";
	
	string sVal = GetLocalArrayString(oObject, sQueue, head);
	DeleteLocalArrayString(oObject, sQueue, head);
	
	SetLocalInt(oObject, _ACR_QUEUE_HEAD_LI + sQueue, head + 1);
	
	return sVal;
}

int GetQueueLength(object oObject, string sQueue) {
	return GetLocalInt(oObject, _ACR_QUEUE_TAIL_LI + sQueue) - GetLocalInt(oObject, _ACR_QUEUE_HEAD_LI + sQueue);
}

#endif