////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR GUI Script
//     Filename : gui_infestpick
//        $Date:: 2014-10-11#$ date the file was created or modified
//       Author : Zelknolf
//
//    Var Prefix: ACR_GUI
//  Dependencies: None
//
//  Description
//  This script is called from the infestation GUI.
//
//  Revision History
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

#include "acr_quest_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main( object TargetObject, float posX, float posY, float posZ, int user, int TargetRegion, int command) 
{
    string sInfest = GetLocalString(GetArea(OBJECT_SELF), ACR_QST_INFESTATION_NAME);
    if(!GetIsDM(OBJECT_SELF))
    {
        SendMessageToPC(OBJECT_SELF, "Only DMs may use this script.");
        return;
    }
    if(!GetIsObjectValid(TargetObject))
    {
        SendMessageToPC(OBJECT_SELF, "No target object found.");
        return;
    }
   
    if(command == 2)
    {
        string sResRef = GetResRef(TargetObject);
        if(sInfest == "")
        {
            sInfest = GetTag(GetArea(OBJECT_SELF));
            AddInfestation(sInfest, 1, sResRef);
        }
        else
        {
            AddInfestationSpawn(sInfest, 1, sResRef);
        }
    }
    else if(command == 4)
    {
        if(sInfest == "") 
        {
            SendMessageToAllDMs("No infestation found to add to.");
            return;
        }
        string sResRef = GetResRef(TargetObject);
        AddInfestationBoss(sInfest, sResRef);
    }
    
    PopulateInfestationGui();
}