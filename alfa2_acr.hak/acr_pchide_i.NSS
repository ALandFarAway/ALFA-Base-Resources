////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR PC Hide System
//     Filename : acr_pchide_i
//      Version : 1.0
//         Date : 2012-07-14
//       Author : FoamBats4All
//
//  Local Variable Prefix = ACR_PCH
//
//  Description
//	  This script handles the hidden creature slot weapon on player characters.
//
////////////////////////////////////////////////////////////////////////////////

#ifndef ACR_PCHIDE_I
#define ACR_PCHIDE_I

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

const string ACR_PCH_RESREF = "acr_pchide";
const int ACR_PCH_SLOT = INVENTORY_SLOT_CARMOUR;

const string ACR_PCH_PREFIX = "pchide_flag_";

const string ACR_PCHIDE_SCRIPT = "acr_pchide";
const int ACR_PCHIDE_ACT_RECALCULATE = 0;

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

//! Returns the PC Hide object.
object ACR_GetPCHide( object oPC );

//! (Re)Initializes the PC Hide.
int ACR_InitializePCHide( object oPC );

//! Force the PC Hide to recalculate itself.
int ACR_RecalculatePCHide( object oPC );

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

object ACR_GetPCHide( object oPC ) {
	object oHide = GetItemInSlot( ACR_PCH_SLOT, oPC );
	
	// If that doesn't work, see if it's not equipped.
	if ( !GetIsObjectValid( oHide ) ) {
		oHide = GetItemPossessedBy( oPC, ACR_PCH_RESREF );
		AssignCommand( oPC, ClearAllActions( FALSE ) );
		AssignCommand( oPC, ActionEquipItem( oHide, INVENTORY_SLOT_CARMOUR ) );
	}
	
	return oHide;
}


int ACR_InitializePCHide( object oPC ) {
	return ACR_RecalculatePCHide( oPC );
}


int ACR_RecalculatePCHide( object oPC ) {
	ClearScriptParams();
	AddScriptParameterObject( oPC );
	AddScriptParameterInt( ACR_PCHIDE_ACT_RECALCULATE );
	return ExecuteScriptEnhanced( ACR_PCHIDE_SCRIPT, OBJECT_SELF, TRUE );
}

#endif
