////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Poison System : On Custom Poison Spell Impact
//     Filename : acr_poison_applied
//      Version : 1.0
//         Date : 2013-02-01
//       Author : FoamBats4All
//
//  Local Variable Prefix = ACR_PSN
//
//  Description
//    This script is called when a custom poison 'spell' on an item hits its
//    target.
//
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

#include "acr_poison_i"


////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main();


////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main() {
	// Our main objects.
	object oPoisoner = OBJECT_SELF;
	object oItem = GetSpellCastItem();
	object oTarget = GetSpellTargetObject();
	
	// All valid objects?
	if ( !GetIsObjectValid( oPoisoner ) || !GetIsObjectValid( oItem ) || !GetIsObjectValid( oTarget ) ) {
		return;
	}
	
	// Is a custom script assigned?
	string sScriptName = GetLocalString( oItem, ACR_PSN_LVAR_SCRIPT_IMPACT );
	if ( sScriptName == "" ) return;
	
	// Call our poison script.
	AddScriptParameterObject( oPoisoner );
	AddScriptParameterObject( oTarget );
	AddScriptParameterObject( oItem );
	ExecuteScriptEnhanced( sScriptName, oPoisoner );
}
